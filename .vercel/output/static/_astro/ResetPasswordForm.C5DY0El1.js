import{j as e}from"./createLucideIcon.Dkxjm4wi.js";import{r}from"./index.BkdHoFEG.js";import{C as o,a as c,b as l,c as d,d as u,A as p,e as w,f as N}from"./label.Di0WFfjI.js";import{s as j,B as g}from"./supabase.client.D2OLuBHL.js";import{P as L}from"./PasswordInput.p3a-TrsH.js";import{v as P}from"./validation.DxFapNvA.js";import{C as T}from"./circle-check-big.Dlp_mO0o.js";import"./index.yjdR7O-I.js";function W(){const[i,k]=r.useState(""),[v,h]=r.useState(),[x,t]=r.useState(),[m,f]=r.useState(!1),[E,I]=r.useState(!1),[A,y]=r.useState(!1),[B,S]=r.useState(!0),[C,R]=r.useState(!1),b=r.useRef(null);r.useEffect(()=>{(async()=>{try{const{data:{session:s}}=await j.auth.getSession();s?y(!0):t("Invalid or expired password reset link.")}catch(s){console.error("Failed to check recovery session:",s),t("Failed to verify reset link. Please try again.")}finally{S(!1)}})();const{data:{subscription:n}}=j.auth.onAuthStateChange(s=>{s==="PASSWORD_RECOVERY"&&(y(!0),S(!1))});return()=>n.unsubscribe()},[]);const F=a=>{k(a),C&&h(void 0)},U=()=>{R(!0);const a=P(i);h(a)},D=async a=>{a.preventDefault(),R(!0);const n=P(i);if(h(n),n){b.current?.focus();return}f(!0),t(void 0);try{const{error:s}=await j.auth.updateUser({password:i});if(s){console.error("Password update error:",s),t("Failed to update password. Please try again."),f(!1);return}I(!0),setTimeout(()=>{window.location.href="/login"},3e3)}catch(s){console.error("Unexpected error:",s),t("An unexpected error occurred. Please try again."),f(!1)}};return B?e.jsxs(o,{className:"w-full max-w-md mx-auto",children:[e.jsxs(c,{children:[e.jsx(l,{children:"Reset your password"}),e.jsx(d,{children:"Verifying reset link..."})]}),e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})})})]}):E?e.jsxs(o,{className:"w-full max-w-md mx-auto",children:[e.jsxs(c,{children:[e.jsx(l,{children:"Password updated!"}),e.jsx(d,{children:"Your password has been successfully reset."})]}),e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(w,{children:"You can now sign in with your new password. Redirecting to login page..."})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(g,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx("a",{href:"/login",children:"Go to Sign In"})})})]})]}):A?e.jsxs(o,{className:"w-full max-w-md mx-auto",children:[e.jsxs(c,{children:[e.jsx(l,{children:"Set new password"}),e.jsx(d,{children:"Enter a new password for your account. Make sure it's at least 8 characters long."})]}),e.jsx(u,{children:e.jsxs("form",{onSubmit:D,className:"space-y-4","aria-label":"Reset password form",children:[x&&e.jsxs(p,{variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(w,{children:x})]}),e.jsx(L,{ref:b,value:i,onChange:F,onBlur:U,error:C?v:void 0,disabled:m,label:"New Password (min. 8 characters)"}),e.jsx(g,{type:"submit",className:"w-full",disabled:m||!!v,"aria-label":"Update password",children:m?"Updating...":"Update Password"}),e.jsx("div",{className:"text-center text-sm",children:e.jsxs("p",{children:["Remember your password?"," ",e.jsx("a",{href:"/login",className:"text-primary hover:underline font-medium",children:"Sign in"})]})})]})})]}):e.jsxs(o,{className:"w-full max-w-md mx-auto",children:[e.jsxs(c,{children:[e.jsx(l,{children:"Reset link expired"}),e.jsx(d,{children:"This password reset link is invalid or has expired."})]}),e.jsxs(u,{children:[e.jsxs(p,{variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(w,{children:x||"Invalid reset link."})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(g,{variant:"default",asChild:!0,children:e.jsx("a",{href:"/auth/forgot",children:"Request New Reset Link"})})})]})]})}export{W as ResetPasswordForm};
